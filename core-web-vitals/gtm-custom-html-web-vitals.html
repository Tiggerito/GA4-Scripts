<script id="web-vitals-ga4">
/*
 * Send Core Web Vitals to the DataLayer 
 * v3.0
 */
function sendToDataLayer(metric) {

  var rating = metric.rating;
  var attribution = metric.attribution;

  var debug_target = attribution ? attribution.largestShiftTarget||attribution.element||attribution.eventTarget||'' : '(not set)';

  var webVitalsMeasurement =  {
    name: metric.name,
    id: metric.id, 
    value: metric.value,
    delta: metric.delta,
    rating: rating,
    valueRounded: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
    deltaRounded: Math.round(metric.name === 'CLS' ? metric.delta * 1000 : metric.delta),
    debug_target: debugTarget.substring(0,100),
    debug_target2: debugTarget.substring(100),
    debug_event: attribution ? attribution.eventType||'' : '',
    debug_timing: attribution ? attribution.loadState||'' : '',
    event_time: attribution ? attribution.largestShiftTime||(attribution.lcpEntry&&attribution.lcpEntry.startTime)||attribution.eventTime||'': ''
  };

  dataLayer.push({
      event: 'coreWebVitals', 
      webVitalsMeasurement: webVitalsMeasurement
  });
}
</script>
<script id="web-vitals-cdn">
/*
 * Using the web-vitals script from a CDN
 * 
 * https://github.com/GoogleChrome/web-vitals#from-a-cdn
 * 
 * Modified to call the sendToGoogleAnalytics function on events
 * 
 */
(function() {
  var script = document.createElement('script');
  script.src = 'https://unpkg.com/web-vitals@3.0.0/dist/web-vitals.attribution.iife.js';
  script.onload = function() {
    // When loading `web-vitals` using a classic script, all the public
    // methods can be found on the `webVitals` global namespace.
    webVitals.onCLS(sendToGoogleAnalytics);
    webVitals.onFID(sendToGoogleAnalytics);
    webVitals.onLCP(sendToGoogleAnalytics);
    webVitals.onFCP(sendToGoogleAnalytics);
    webVitals.onTTFB(sendToGoogleAnalytics);
    webVitals.onINP(sendToGoogleAnalytics);
  }
  document.head.appendChild(script);
}())
</script>